<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Mixing Mechanisms: How Language Models Retrieve Bound Entities In-Context | Yoav Gur-Arieh </title> <meta name="author" content="Yoav Gur-Arieh"> <meta name="description" content="To reason, LMs must bind together entities in-context. How they do this is more complicated than was first thought."> <meta name="keywords" content="yoav gur arieh Yoav Gur Arieh"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?aefbff3a2778581e8c78a18aab7c6547"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://yoavgur.github.io/blog/2025/mixing-mechs/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Mixing Mechanisms: How Language Models Retrieve Bound Entities In-Context",
            "description": "To reason, LMs must bind together entities in-context. How they do this is more complicated than was first thought.",
            "published": "September 29, 2025",
            "authors": [
              
              {
                "author": "Yoav Gur-Arieh",
                "authorURL": "https://yoav.ml",
                "affiliations": [
                  {
                    "name": "Tel Aviv University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Mor Geva",
                "authorURL": "https://mega002.github.io/",
                "affiliations": [
                  {
                    "name": "Tel Aviv University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Atticus Geiger",
                "authorURL": "http://prair.group/",
                "affiliations": [
                  {
                    "name": "Pr(Ai)²R",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Yoav</span> Gur-Arieh </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Mixing Mechanisms: How Language Models Retrieve Bound Entities In-Context</h1> <p>To reason, LMs must bind together entities in-context. How they do this is more complicated than was first thought.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#introduction">Introduction</a></div> <div><a href="#three-mechanisms">Three Mechanisms For Binding and Retrieval</a></div> <div><a href="#results-and-analyses">Results and Analyses</a></div> <div><a href="#causal-model">A Simple Model for Simulating Entity Retrieval In-Context</a></div> <div><a href="#free-form">Introducing Free Form Text Into the Task</a></div> <div><a href="#conclusion">Conclusion</a></div> <div><a href="#interactive">Interactive Figure</a></div> </nav> </d-contents> <p><strong>TL;DR</strong>: Entity binding in LMs is crucial for reasoning in LMs. Prior work established a <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism underlying binding, but we find that it breaks down in complex settings. We uncover two additional mechanisms—<mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark>—that drive model behavior.</p> <p><a href="#interactive">Jump to the interactive demo below</a></p> <figure style="display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 1200px; margin-left: auto; margin-right: auto;"> <div style="width: 100%; max-width: min(150%, 1200px); margin-left: auto; margin-right: auto;" data-binding-demo="" data-mode="animated" data-initial-n="10" data-initial-ip="4" data-initial-il="4" data-initial-ir="4" data-initial-target="2" data-show-title="false" data-show-sentence="true" data-animation-sequence='[{"iL":4,"delay":500},{"iR":4,"delay":1500}, {"iL":10,"delay":500}, {"iR":8,"delay":1500}]'> </div> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem;"> <strong>Figure 1</strong>: A list of entities that need to be bound together is provided to the model. We see the model's (real collected) token probabilities, first when setting the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> (pos) / <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> (lex) / <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> (ref) mechanisms to point to the same entity, and then when pointing them at different entities. Interactive version <a href="#interactive">here</a>. </figcaption> </figure> <h3 id="introduction" style="scroll-margin-top: 80px;">Introduction</h3> <p>Language models (LMs) are known for their ability to perform in-context reasoning, and fundamental to this capability is the task of connecting related entities in a text—known as <em>binding</em>—to construct a representation of context that can be queried for next token prediction. For example, to represent the text <em>Pete loves jam and Ann loves pie</em>, an LM will bind <em>Pete</em> to <em>jam</em> and <em>Ann</em> to <em>pie</em>. This enables the LM to answer questions like <em>Who loves pie?</em> by querying the bound entities to retrieve the answer (<em>Ann</em>). The prevailing view is that LMs retrieve bound entities using a <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism<d-cite key="dai-etal-2024-representational"></d-cite><d-cite key="prakash2024finetuning"></d-cite><d-cite key="prakash2025languagemodelsuselookbacks"></d-cite>, where the query entity (<em>pie</em>) is used to determine the in-context position of <em>Ann loves pie</em>—in this case, the second clause after <em>Pete loves jam</em>—which is dereferenced to retrieve the answer <em>Ann</em>.</p> <p>However, we show that the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism becomes unreliable for middle positions in long lists of entity groups, echoing the <em>lost-in-the-middle</em> effect<d-cite key="liu-etal-2024-lost"></d-cite>. To compensate for this, LMs supplement the positional mechanism with a <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> mechanism, where the query entity (<em>pie</em>) is used to retrieve its bound counterpart (<em>Ann</em>), and a <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanism, where the queried entity (<em>Ann</em>) is retrieved with a direct pointer that was previously retrieved via the query entity (<em>pie</em>). See Figure <a href="#figure-2">2</a> for illustration.</p> <p>In this post we describe exactly how LMs use the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms for entity binding and retrieval, which we validate across (1) nine models from the Llama, Gemma and Qwen model families (2-72B parameters), and (2) ten different binding tasks. These mechanisms and their interactions remain consistent across all of these, establishing a general account of how LMs bind and retrieve entities.</p> <figure id="figure-2" style="display: flex; flex-direction: column; align-items: center; border: none; margin: 0; padding: 0;"> <a href="/assets/img/mechs_fig1.png" target="_blank" style="display:block; max-width:100%;text-decoration:none!important;border-bottom:0!important;box-shadow:none!important; background-image:none!important;"> <img src="/assets/img/mechs_fig1.png" alt="Mechanisms Figure 1" style="display:block; max-width:100%; height:auto; cursor:zoom-in; border:0;"> </a> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem; border: none;"> <strong>Figure 2</strong>: An illustration of the three mechanisms for retrieving bound entities in-context and how we isolate them. We find that as models process inputs with groups of entities: (A) binding information of three types—<mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark>, <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark>—is encoded in the entity tokens of each group, (B) this binding information is jointly used to retrieve entities in-context, and (C) it is possible to separate the three binding signals with counterfactual patching. </figcaption> </figure> <h3 id="three-mechanisms">Three Mechanisms For Binding and Retrieval</h3> <p>The prevailing view is that entities are bound and retrieved with a <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism <d-cite key="dai-etal-2024-representational"></d-cite><d-cite key="prakash2024finetuning"></d-cite><d-cite key="prakash2025languagemodelsuselookbacks"></d-cite>. However, since this mechanism fails to explain model behavior in more complex settings, we propose and test two alternatives for how LMs might implement binding. To do this, we design datasets with pairs of original and counterfactual inputs, such that each of the three proposed mechanisms makes a distinct prediction under an interchange intervention with the pair. This is illustrated in Figure <a href="#figure-2">2</a>. Our three hopythesized mechanisms are:</p> <ul> <li> <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>Positional</b></mark> - given a query entity (What does <strong>Tim</strong> love?), the model extracts the index of the entity group to which it belongs (<strong>4</strong>), and retrieves the queried entity (<strong>tea</strong>) from it. Thus, patching this binding information from the counterfactual (where the queried entity group index is <strong>2</strong>) to the original would make the model respond with the answer from entity group number 2 (<strong>jam</strong>).</li> <li> <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>Lexical</b></mark> - where instead of using the position of the query entity, the model uses its lexical content to retrieve the bound entity from the group containing the query entity. This is achieved by copying the lexical contents of the <strong>Tim</strong> token into the <strong>tea</strong> token position (illustrated in Figure <a href="#figure-2">2</a> with a key), which can then trigger the attention of the query token (<strong>Tim</strong>), enabling retrieval of the bound entity (<strong>tea</strong>). Thus, patching in this binding information from the counterfactual (where the query entity is <strong>Ann</strong>) to the original would make the model respond with the answer from the entity group with Ann (<strong>ale</strong>).</li> <li> <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>Reflexive</b></mark> - where each entity in an entity group also encodes a pointer that points directly to itself, which can then by copied to other entities in its entity group and dereferenced in order to retrieve its originating entity. This mechanism is needed because the lexical mechanism, as described previously, requires information being copied between entity tokens to bind them together. However, if we query the first token in an entity group (i.e. <strong>Who loves tea?</strong>), then this mechanism would be useless, since the causal attention mask forbids the lexical contents of <strong>tea</strong> being copied <em>backward</em> to <strong>Tim</strong>. Thus, reflexive binding information pointing to <strong>Tim</strong> and originating from it, is copied <em>forward</em> to the <strong>tea</strong> token position, which can then be retrieved using the query entity (Who loves <strong>tea</strong>?), and used to retrieve <strong>Tim</strong>. Thus, in Figure <a href="#figure-2">2</a>, patching in this binding information from the counterfactual (where the answer entity is <strong>pie</strong>) to the original would make the model respond with <strong>pie</strong>. Note that this behavior is identical to patching in the answer itself from the counterfactual to the original, but we disambiguate these two mechanisms in multiple subsequent experiments involving more elaborate datasets as well as attention knockouts<d-cite key="geva-etal-2023-dissecting"></d-cite>, confirming the existence of this mechanism. Note also that this binding information only points to the token from which it originated (using its lexical content). Therefore, patching this binding information to a prompt where the <strong>pie</strong> entity doesn’t exist would lead to the model not being able to use this mechanism for retrieval.</li> </ul> <figure id="figure-3" style="display: flex; flex-direction: column; align-items: center; border: none; margin: 0; padding: 0;"> <a href="/assets/img/u_plot_gemma-2-2b.png" target="_blank" style="display:block; max-width:100%;text-decoration:none!important;border-bottom:0!important;box-shadow:none!important; background-image:none!important;"> <img src="/assets/img/u_plot_gemma-2-2b.png" alt="Mechanisms Figure 1" style="display:block; max-width:100%; height:auto; cursor:zoom-in; border:0;"> </a> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem; border: none;"> <strong>Figure 3</strong>: Results from interchange interventions on gemma-2-2b-it over a counterfactual dataset with three entities per group. Outputs predicted by the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms are shown in dark blue, green and orange. Here $t_{entity}$ is the target entity, i.e. the entity being queried in the counterfactual example. <b>Left</b>: Distribution of effects for three representative entity group indices (first, middle, and last) with $t_{\text{entity}}=3$. At layers 16–18, the last token position carries binding information used for retrieval. <b>Right</b>: Distribution of effects for all indices at layer 18 for $t_{\text{entity}} \in \{1,2,3\}$, i.e., the question can be about any of the three entities in each clause. A U-shaped curve emerges: first and last indices rely more on the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism, while middle indices rely more on the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms. In the full paper, we replicate these exact results across all nine models and ten binding tasks. </figcaption> </figure> <h3 id="results-and-analyses">Results and Analyses</h3> <p>In Figure <a href="#figure-3">3</a>, we see the results of our interchange interventions for gemma-2-2b-it (replicated for all other models in the paper). We also collect the mean output probabilities for each possible answer entity post patching, highlighting the entities pointed to by each of the mechanisms, to understand the interplay between the three mechanisms.</p> <h4 id="aggregating-binding-information">Aggregating Binding Information</h4> <p>We see in Figure <a href="#figure-3">3</a> that in layers 0-15, no binding information exists in the last token position, since patching it doesn’t have any effect on model behavior. In layers 19-25, the model has already retrieved the bound entity, since patching the last token position leads to the model responding with the answer from the counterfactual example. However, in layers 16-18 we see that the model has aggregated the binding information in the last token position, since patching it from the counterfactual to the original leads the model to respond with entities corresponding to the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms.</p> <h4 id="the-positional-mechanism-is-weak-and-diffuse-in-middle-positions">The Positional Mechanism is Weak and Diffuse in Middle Positions</h4> <p>Figure <a href="#figure-3">3</a> shows that the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism controls model behavior only when querying the first few and last entity groups. In middle entity groups, however, its effect becomes minimal, only accounting for ~20% of model behavior.</p> <p>In Figure <a href="#figure-4">4</a> we see the mean probabilities for each answer entity (in order of their entity group index, i.e. in order of appearance in context), fixing the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms to point to the first entity, and sliding the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism across all values. We see that the mechanism induces a strong concentrated distribution around the entity pointed to by the positional mechanism in the beginning and end, but that in middle entity groups its distribution becomes weak and diffuse. This indicates that the model struggles to use positional information to bind together entities in middle entity groups, making it unreliable as the sole mechanism for binding.</p> <figure id="figure-4"> <div data-binding-demo="" data-mode="animated" data-initial-n="10" data-initial-ip="1" data-initial-il="1" data-initial-ir="1" data-initial-target="1" data-show-title="false" data-show-sentence="false" data-animation-sequence='[{"iP":1,"delay":1500},{"iP":2,"delay":1500},{"iP":3,"delay":1500},{"iP":4,"delay":1500},{"iP":5,"delay":1500},{"iP":6,"delay":1500},{"iP":7,"delay":1500},{"iP":8,"delay":1500},{"iP":9,"delay":1500},{"iP":10,"delay":1500}]'> </div> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem;"> <strong>Figure 4</strong>: Mean probabilities for all answer entities, fixing the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms to point to the first entity, and sliding the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism across all values. </figcaption> </figure> <p><br></p> <h4 id="interplay-between-the-mechanisms">Interplay Between The Mechanisms</h4> <p>We see in Figure <a href="#figure-5">5</a> that, contrary to the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism, the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms induce one-hot distributions at their target entities. The distributions induced by the three mechanisms then interact with each other in shaping the model’s behavior, both boosting and suppressing each other. We see for example that when the lexical / reflexive mechanisms point at entities near the positional one, their probabilities increase dramatically, while simultaneously suppressing that of the entity pointed to by the positional mechanism.</p> <figure id="figure-5"> <div data-binding-demo="" data-mode="animated" data-initial-n="8" data-initial-ip="4" data-initial-il="1" data-initial-ir="8" data-initial-target="1" data-show-title="false" data-show-sentence="false" data-animation-sequence='[{"iL":1,"delay":1000},{"iL":2,"delay":1000},{"iL":3,"delay":1000},{"iL":4,"delay":1000},{"iL":5,"delay":1000},{"iL":6,"delay":1000},{"iL":7,"delay":1000},{"iL":8,"delay":1000}, {"iR":1,"delay":1000},{"iR":2,"delay":1000},{"iR":3,"delay":1000},{"iR":4,"delay":1000},{"iR":5,"delay":1000},{"iR":6,"delay":1000},{"iR":7,"delay":1000},{"iR":8,"delay":1000}]'> </div> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem;"> <strong>Figure 5</strong>: Interaction between the different mechanisms. We fix the entity pointed to by the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism, and slide the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms. </figcaption> </figure> <h3 id="causal-model">A Simple Model for Simulating Entity Retrieval In-Context</h3> <p>To formalize out observations about the dynamics between the three mechanisms and the position of the queried entity, we develop a high-level causal model<d-cite key="geiger2021causal"></d-cite> that approximates LM logits for next token prediction. We formalize this as a position-weighted mixture of terms for the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms. In accordance with the results in Figure <a href="#figure-5">5</a>, we model the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms as one-hot distributions that up-weight only entities pointed to by those mechanisms, while the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism is modeled as a gaussian distribution scaled by a single weight, with a standard deviation that is a quadratic function of the positional index. Formally:</p> <div style="overflow-x:auto;"> $$Y_i := \underbrace{w_{\mathrm{pos}} \cdot \mathcal{N}\left(i \mid i_P, \sigma(i_P)^2\right)}_{\text{positional mechanism}} + \underbrace{w_{\mathrm{lex}}\!\left[i_L\right]\cdot \mathbf{1}\!\left\{i = i_L\right\}}_{\text{lexical mechanism}} + \underbrace{w_{\mathrm{ref}}\!\left[i_R\right]\cdot \mathbf{1}\{i=i_R\}}_{\text{reflexive mechanism}}$$ </div> <p>Where $i_{P/L/R}$ are the entity group indices pointed by the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms respectively, and $\sigma(i_P) = \alpha (\frac{i_P}{n})^2 + \beta \frac{i_P}{n} + \gamma$. We learn $w_{pos},w_{lex},w_{ref},\alpha, \beta, \gamma$ from data.</p> <p>To train and evaluate our model, we collect the logit distributions per index combination, and average them into mean probability distributions by first applying a softmax over the entity group indices, and then take taking the mean. We calculate the loss using Jensen-Shannon divergence (chosen for its symmetry), and measure performance using Jensen-Shannon similarity (JSS), its complement, which ranges from 0 to 1. We also compare our model to the prevailing view (one-hot distribution at $i_P$), as well as various ablations of our model. Finally, we compare our model to an oracle variant, an upper bound where we replace the learned gaussian with the actual collected probabilities.</p> <figure id="table-1" style="width:100%;"> <div style="overflow-x:auto;"> <table style="width:100%; border-collapse:collapse;"> <thead> <tr> <th style="text-align:left;"><strong>Model</strong></th> <th style="text-align:center;"><strong>JSS ↑ $(t_e=1)$</strong></th> <th style="text-align:center;"><strong>JSS ↑ $(t_e=2)$</strong></th> <th style="text-align:center;"><strong>JSS ↑ $(t_e=3)$</strong></th> </tr> </thead> <tbody> <tr><td colspan="4" style="text-align:center;"><em>Comparing against the prevailing view</em></td></tr> <tr> <td>$\mathcal{M}(L_{\text{one-hot}}, R_{\text{one-hot}}, P_{\text{Gauss}})$</td> <td style="text-align:center;"><strong>0.95</strong></td> <td style="text-align:center;"><strong>0.96</strong></td> <td style="text-align:center;"><strong>0.94</strong></td> </tr> <tr> <td>$\mathcal{P}_{\text{one-hot}}$ (prevailing view)</td> <td style="text-align:center;">0.42</td> <td style="text-align:center;">0.46</td> <td style="text-align:center;">0.45</td> </tr> <tr><td colspan="4" style="text-align:center;"><em>Modifying the positional mechanism</em></td></tr> <tr> <td>$\mathcal{M}$ w/ $P_{\text{oracle}}$</td> <td style="text-align:center;">0.96</td> <td style="text-align:center;">0.98</td> <td style="text-align:center;">0.96</td> </tr> <tr> <td>$\mathcal{M}$ w/ $P_{\text{one-hot}}$</td> <td style="text-align:center;">0.86</td> <td style="text-align:center;">0.85</td> <td style="text-align:center;">0.85</td> </tr> <tr><td colspan="4" style="text-align:center;"><em>Ablating the three mechanisms</em></td></tr> <tr> <td>$\mathcal{M} \setminus \{P_{\text{Gauss}}\}$</td> <td style="text-align:center;">0.67</td> <td style="text-align:center;">0.68</td> <td style="text-align:center;">0.67</td> </tr> <tr> <td>$\mathcal{M} \setminus \{L_{\text{one-hot}}\}$</td> <td style="text-align:center;">0.94</td> <td style="text-align:center;">0.91</td> <td style="text-align:center;">0.75</td> </tr> <tr> <td>$\mathcal{M} \setminus \{R_{\text{one-hot}}\}$</td> <td style="text-align:center;">0.69</td> <td style="text-align:center;">0.87</td> <td style="text-align:center;">0.92</td> </tr> <tr> <td>$\mathcal{M} \setminus \{R_{\text{one-hot}}, L_{\text{one-hot}}\}$</td> <td style="text-align:center;">0.69</td> <td style="text-align:center;">0.84</td> <td style="text-align:center;">0.74</td> </tr> <tr> <td>$\mathcal{M} \setminus \{P_{\text{Gauss}}, R_{\text{one-hot}}\}$</td> <td style="text-align:center;">0.12</td> <td style="text-align:center;">0.27</td> <td style="text-align:center;">0.48</td> </tr> <tr> <td>$\mathcal{M} \setminus \{P_{\text{Gauss}}, L_{\text{one-hot}}\}$</td> <td style="text-align:center;">0.55</td> <td style="text-align:center;">0.41</td> <td style="text-align:center;">0.20</td> </tr> <tr> <td>Uniform</td> <td style="text-align:center;">0.44</td> <td style="text-align:center;">0.57</td> <td style="text-align:center;">0.49</td> </tr> </tbody> </table> </div> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem;"> <strong>Table 1:</strong> Jensen-Shannon similarity (JSS) results for training our full model $\mathcal{M}$, in addition to variants, baselines and ablations. We show results for $t_e \in [3]$, i.e. when querying the first, second and third entities in an entity group, respectively. </figcaption> </figure> <p><br></p> <p>We see in Table <a href="#table-1">1</a> that our model achieves near perfect results (0.95), only slightly below the oracle variant (0.97). We also see that the model representing the prevailing view achieves much worse results (0.44), well below even a uniform distribution (0.5). Finally, we can see when each component of our model is important for modeling the LM’s behavior: when querying the first entity in a group, the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> mechanism is not crucial for modeling the LM’s behavior, while when querying the last entity the <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> one isn’t, in line with our hypothesis.</p> <h3 id="free-form">Introducing Free Form Text Into the Task</h3> <p>To test our model’s generalization to more realistic inputs, we modify our binding tasks such that they include filler sentences between each entity group. To this end, we create 1,000 filler sentences that are “entity-less”, meaning they do not contain sequences that signal the need to track or bind entities, e.g. “Ann loves ale, <em>this is a known fact</em>, Joe loves jam, <em>this logic is easy to follow</em>…”. This enables us to evaluate entity binding in a more naturalistic setting, containing much more noise and longer sequences. We evaluate different levels of padding by interleaving the entity groups with an increasing number of filler sentences, for a maximum of 500 tokens between each entity group.</p> <figure id="figure-6" style="display: flex; flex-direction: column; align-items: center; border: none; margin: 0; padding: 0;"> <a href="/assets/img/filler_trends_stacked.png" target="_blank" style="display:block; max-width:100%;text-decoration:none!important;border-bottom:0!important;box-shadow:none!important; background-image:none!important;"> <img src="/assets/img/filler_trends_stacked.png" alt="Mechanisms Figure 1" style="display:block; max-width:100%; height:auto; cursor:zoom-in; border:0;"> </a> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem; border: none;"> <strong>Figure 6</strong>: Distribution of effects as padding is increased, showing the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism strengthens at the expense of the <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> mechanism. </figcaption> </figure> <p><br></p> <p>The results, shown in Figure <a href="#figure-6">6</a> and <a href="#figure-7">7</a>, show that our model at first remains remarkably consistent in more naturalistic settings, across even a ten-fold increase in the number of tokens. However, as the amount of filler tokens increases, we see that the magnitude of the mechanisms’ effects changes. The <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> mechanism declines in its effect, while the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> and mixed effects slightly increase. We can also see that the mixed effect remains distributed around the positional index, but that it slowly becomes more diffuse. Thus, when padding with 10,000 tokens, we get that other than the first entity group, the positional information becomes nearly non-existent for the first half of entity tokens, while remaining stronger in the latter half. This suggests that a weakening lexical mechanism relative to an increasingly noisy positional mechanism might be a mechanistic explanation of the “lost-in-the-middle” effect<d-cite key="liu-etal-2024-lost"></d-cite>.</p> <figure id="figure-7" style="display: flex; flex-direction: column; align-items: center; border: none; margin: 0; padding: 0;"> <a href="/assets/img/confusion_matrix_padding.png" target="_blank" style="display:block; max-width:100%;text-decoration:none!important;border-bottom:0!important;box-shadow:none!important; background-image:none!important;"> <img src="/assets/img/confusion_matrix_padding.png" alt="Mechanisms Figure 1" style="display:block; max-width:100%; height:auto; cursor:zoom-in; border:0;"> </a> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem; border: none;"> <strong>Figure 7</strong>: Confusion matrix between the model's predicted index and the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> index patched in from the counterfactual. This gets increasingly fuzzy for early tokens as padding is increased. </figcaption> </figure> <h3 id="conclusion">Conclusion</h3> <p>In our work, we challenge the prevailing view that LMs retrieve bound entities purely with a <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism. We find that while the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> mechanism is effective for entities introduced at the beginning or end of context, it becomes diffuse and unreliable in the middle. We show that in practice, LMs rely on a mixture of three mechanisms: <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark>, and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark>. The lexical and reflexive mechanisms provide sharper signals that enable the model to correctly bind and retrieve entities throughout. We validate our findings across 9 models ranging from 2B to 72B parameters, and 10 binding tasks, establishing a general account of how LMs retrieve bound entities.</p> <hr> <h3 id="interactive" style="scroll-margin-top: 80px;"> Interactive Figure </h3> <p>Here we provide an interactive figure, showing the mean output probabilities (gemma-2-2b-it) over the possible answer entities contingent on which entities are pointed to by the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark>, <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> and <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms (pos, lex and ref respectively). You can control the number of entity groups in the context (n), as well as which entity in a group is queried (target). See the <a href="#introduction">full blog post</a> or our paper to understand more about how LMs perform binding and retrieval.</p> <figure> <div data-binding-demo="" data-mode="interactive" data-initial-n="10" data-initial-ip="4" data-initial-il="10" data-initial-ir="8" data-initial-target="2" data-show-title="true" data-show-sentence="true"></div> <figcaption style="font-size: 0.9em; color: #6c757d; margin-top: 0.5rem;"> Figure 7: Interactive version where you can set how many entities exist, and the entities pointed to by the <mark style="background:rgb(214, 232, 252); color: #2e73b3ff; padding: 0.1em 0.3em; border-radius: 0.2em;"><b>positional</b></mark> / <mark style="background:rgb(203, 232, 221); color:rgb(26, 147, 98); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>lexical</b></mark> / <mark style="background:rgb(255, 231, 203); color:rgb(252, 156, 46); padding: 0.1em 0.3em; border-radius: 0.2em;"><b>reflexive</b></mark> mechanisms. </figcaption> </figure> <hr> <p>Please cite this as:</p> <div class="language-bibtex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">TODO</span>
</code></pre></div></div> <link rel="stylesheet" href="/assets/css/binding-demo/index-BEOe_g9O.css"> <script type="module" defer src="/assets/js/binding-demo/index-B_g5bwzp.js"></script> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2025-09-29-mixing-mechs.bib"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Yoav Gur-Arieh. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>